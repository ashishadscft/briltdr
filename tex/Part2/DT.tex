\chapter{Muon Drift Tube Luminometer}
\label{sec:DT-lumi}
%%
%%For muon trigger stub counting, the use of trigger scouting methods prototyped at the end of Run 2
%%will allow per-bunch emittance scan analysis as well as luminosity measurement in physics conditions.
%%Muon trigger stub counting in Run 2 was orbit-integrated at per-LS frequency in real time;
%%using trigger scouting online bunch-by-bunch measurement at 4LN frequency is targeted in Run 3.
%%
%%It is also foreseen to ... expand the muon DT and resistive plate chamber (RPC) functionality to provide bunch-by-bunch
%%trigger primitives instead of a value integrated over a complete orbit.
%% orbit-integrated DT muon stub counting in Run 2 was available in real time at LS frequency.
%%
%%In Run 2, techniques like the DT muon trigger stub counting and the RAMSES radiation monitoring have proven
%%to be useful for stability and linearity studies, and they are planned to be exploited also in Phase-2.
%%To alleviate some of the limitations and allow per-bunch measurements, there is a requirement for Phase-2
%%for the upgrade of the muon counting for luminosity to have a 40MHz readout, as described in Section 7.4.2.
%%
%%In Run 2, counting of track candidates in the barrel muon systems has been shown to have good
%%linearity and can be used for stability and linearity monitoring of other luminometers. The CMS
%%DT chambers are installed in the return barrel yoke and provide muon tracking and triggering
%%for CMS physics operation. The observable used in both Run 1 and Run 2 was the barrel sorter
%%rate from the barrel muon track finder (BMTF), which counts muon track candidates with lumi
%%section granularity, but integrated over all bunches in the orbit. The statistical uncertainty
%%in the orbit-integrated rates at a luminosity of 2 x 1034 cm2 s1 is 0.2\%.
%% Assuming a fill of 2544 equally populated colliding bunches, the statistical uncertainty per BX would be 12%.
%% A naive extrapolation to a total luminosity of 51034 cm2 s1 for HL-LHC yields a statistical
%% uncertainty per BX of 8%.
%%
%%Drift tube muon system: As mentioned, the current implementation of DT luminosity
%%is extremely useful, but it does not provide the necessary statistical precision and
%%time granularity to meet Phase-2 requirements. Thus the rates and statistical uncertainties
%%achievable with different levels of muon trigger objects need to be studied
%%in detail to identify the most suitable one for a 40MHz precision online measurement.
%%The possibility of using the DT back-end electronics for dedicated luminosity
%%processing during Run 3 should be investigated.
%%

During Run 2, counting of muon track candidates from the CMS Level 1 system, the Barrel Muon Track Finder (BMTF) ,
has proven to be useful for the luminosity systematics estimation due its excellent linearity and stability \cite{LUM-17-001}.
The observable used was the barrel track soter rate which counts the BMTF track candidates
integrated over the entire orbit and over one lumi section ($\sim$23 s) period.
The statistical precision of this counter for the Run 2 instantaneous luminosity was of order 0.2\%.
This counter was recorded by the BRIL-DAQ in real time,
however was of limited use for online luminosity measurement due to the
lack of per bunch information and relatively long integration time.
A per bunch luminosity measurement at the HL-LHC instantaneous luminosity of
$5\text{-}7\times10^{34}\ \text{cm}^{-2}\text{s}^{-1}$ is expected to be of the order of $8\%$,
which does not provide enough precision for an online luminometer and does not allow for an independent calibration
during the vdM scans nor long term stability corrections from the emmittance scans.
Below we describe an improved luminometer design based on muon trigger primitives, which will be available per bunch crossing at 40 MHz
from the Phase II backend of the muon barrel detector for each of the Muon Drift Tube (DT) chambers, and provides higher count rates.


\section{Detector Description and Trigger Primitives}

The Muon DT chambers are installed in the barrel yoke of the CMS detector \cite{DT-2009}.
A total of 250 chambers are distributed in 5 wheels (YB=0,$\pm$1,$\pm$2) and four radial layers (MB=1-4),
a longitudinal view of the entire  CMS muon system is shown in Figure~\ref{fig:DT_layout}.
The RPC chambers are also visible in this diagram as layers RB1-RB4 in front of the DT chambers.

Hits from both the DT and RPC chambers will be combined to reconstruct muon track segments (Trigger Primitives) per DT chamber for the muon reconstruction in the Level 1 system in Phase II \cite{CERN-LHCC-2017-012}.
The rates of these trigger primitives have been studied using Run 2 data.
Figure~\ref{fig:DT_rates} shows the rates for the YB+2  DT chambers,
the values have been extrapolated up to the expected HL-LHC instantaneous luminosity of  $7.5\times10^{34}\ \text{cm}^{-2}\text{s}^{-1}$ from the measured values in Run 2 data.
We observe that the chambers in the first radial layer MB1 detect the highest rate and the rate decreases to less than 10\% in the outermost layer,
this behaviour is consistent with particles from the jet punch-through observed by the inner layers.
In the MB4 layer we also observe a phi asymmetry with higher rates on the top of the detector (Sectors 3-5), believed to be due to machine induced backgrounds,
for this reason we expect to exclude this layer from the final luminosity calculation as the rates are not expected to scale linearly with the number of IP collisions. 


\begin{figure}[hbtp]
\centering
\includegraphics[width=.8\linewidth]{tex/Part2/fig/DT/DT-longitudinal.png}
\includegraphics[width=.7\linewidth]{tex/Part2/fig/DT/DT-transverse.png}
\caption{
  Longitudinal view of one quarter of the CMS muon detector system (top) showing the Drift Tube chambers in the barrel region
  and transverse view (bottom) showing the 12 phi sectors and a muon track trayectory.
  The numbering scheme for the chambers is shown in within the figure and consists of a wheel number, a radial station number (MB), and phi sector.
}
\label{fig:DT_layout}
\end{figure}


\begin{figure}[hbtp]
\centering
\includegraphics[width=.7\linewidth]{tex/Part2/fig/DT/DT-RatesExtrapolated.png}
\caption{DT L1 trigger primitive rates for the chambers in the wheel YB+2.} 
\label{fig:DT_rates}
\end{figure}



\section{Data Acquisition}
- DT backend \\
- trigger primitive histogramming \\
- data transfer

The muon detector system readout electronics will undergo a complete upgrade for Phase-2 in order to cope with the higher data rates and L1 trigger demands.
Figure~\ref{fig:DT_DAQ2} shows a comparison of the current components of the DT backend and the new design for Phase-2 \cite{CERN-LHCC-2017-012}.
In the Phase-2 design, the frontend electronics are upgraded with On-Board Electronics for DT (OBDT) in new Minicrate 2 boards based on FPGA's.
The data including the full collection of chamber hits will be continously streamed via high speed 8 GBT optical links to the backend Layer 1 processor boards (L1 processors) where the trigger primitives are reconstructed.

For the online luminosity measurement, the generic BRIL Histogramming firmware described before will be installed as part of the Layer 1 processor boards in the backend.
This histogramming module will access and count the list of trigger primitives in parallel to the CMS L1 trigger stream, and produce a histogram with per bunch counts (3564 bins) integrated over a 1 second period.
The 



%\begin{figure}[hbtp]
%\centering
%\includegraphics[width=.65\linewidth]{tex/Part2/fig/DT/DT-DAQoverview.png}
%\caption{Design  of the Muon DAQ system architecture for Phase II showing the different layers where the L1 trigger objects are generated. In  this layout the DT trigger primitives are generated in the Layer 1 of the backend.}   
%\label{fig:DT_DAQ}
%\end{figure}

\begin{figure}[hbtp]
\centering
\includegraphics[width=.65\linewidth]{tex/Part2/fig/DT/DT-DAQ-Phase1_vs_Phase2.png}
\caption{Current partition of the DT system readout electronics (left) and Phase-2 upgrade design (right) using On-Board Electronics for DT (OBDT).
  The muon trigger primitives are produced by the L1 processors.
}   
\label{fig:DT_DAQ2}
\end{figure}




\section{Expected Performance}
- Rates \\ 
- linearity \\
- statistical precision 





\begin{figure}[hbtp]
\centering
\includegraphics[width=.7\linewidth]{tex/Part2/fig/DT/DT-Linearity.png}
\caption{DT L1 trigger primitive rates for one chamber  as a function of instantenous luminosity measured by the HF luminometer in Run 2 data.} 
\label{fig:DT_linearity}
\end{figure}


